---
import BaseLayout from "../layouts/BaseLayout.astro";
import Header from "../components/Header.astro";
import Footer from "../components/Footer.astro";
import Hero from "../components/Hero.astro";
import SocialLinks from "../components/SocialLinks.astro";
import { getCollection } from "astro:content";

const projects = await getCollection("projects");
const allProjects = [...projects].sort((a, b) => (a.data.date < b.data.date ? 1 : -1));
const homeStoryLinks = [
  "https://wapo.st/4lK1zjz",
  "https://wapo.st/3WjjAKt",
  "https://wapo.st/3XAaHMz",
  "https://wapo.st/3OssBQh",
  "https://wapo.st/4lRmktN",
];
const curatedHomeStories = homeStoryLinks
  .map((url) => projects.find((p) => p.data.externalUrl === url))
  .filter(Boolean)
  .filter((p) => p.data.heroImage);
const homeStories = (curatedHomeStories.length === 5
  ? curatedHomeStories
  : allProjects.filter((p) => p.data.heroImage).slice(0, 5));
const graphicsCarouselLinks = [
  "https://wapo.st/4lK1zjz",
  "https://wapo.st/3WjjAKt",
  "https://wapo.st/3XAaHMz",
  "https://wapo.st/3OssBQh",
];
const graphicsCarouselProjects = graphicsCarouselLinks
  .map((url) => projects.find((p) => p.data.externalUrl === url))
  .filter(Boolean)
  .filter((p) => p.data.heroImage)
  .slice(0, 4);

const homeCarouselSource = graphicsCarouselProjects.length === 4
  ? graphicsCarouselProjects
  : [...projects]
      .sort((a, b) => (a.data.date < b.data.date ? 1 : -1))
      .filter((p) => p.data.heroImage)
      .slice(0, 4);

const homeCarouselSlides = homeCarouselSource.map((p) => ({
  src: p.data.heroImage,
  alt: p.data.title,
  title: p.data.title,
  href: p.data.externalUrl || `/projects/${p.slug}/`,
}));

const dateFormatter = new Intl.DateTimeFormat("en-US", {
  month: "long",
  day: "numeric",
  year: "numeric",
});

function formatDisplayDate(dateText) {
  const parsed = new Date(dateText);
  return Number.isNaN(parsed.getTime()) ? dateText : dateFormatter.format(parsed);
}
---
<BaseLayout title="Nick Mourtoupalas | Graphics and data visualization" description="Professional portfolio of graphics journalism and data visualization.">
  <Fragment slot="header"><Header /></Fragment>
  
  <Hero slides={homeCarouselSlides} />

  <section class="section">
    <div class="container">
      <div class="featured-intro">
        <h2 class="featured-title">Featured Work</h2>
        <p class="featured-statement">
          A selection of recent graphics and data journalism projects, from fast-turn vote trackers to deeply reported explainers.
        </p>
      </div>

      <div class="feature-list">
        {homeStories.map((p, index) => {
          const href = p.data.externalUrl || `/projects/${p.slug}/`;
          const target = p.data.externalUrl ? "_blank" : "_self";
          return (
            <a
              class={`feature-row ${index % 2 ? "is-reversed" : ""}`}
              href={href}
              target={target}
              rel={p.data.externalUrl ? "noopener noreferrer" : ""}
              aria-label={p.data.title}
            >
              <div class="feature-media">
                {p.data.heroImage ? (
                  <img
                    class="feature-image"
                    src={p.data.heroImage}
                    alt={p.data.title}
                    loading="lazy"
                  />
                ) : (
                  <div class="feature-image feature-placeholder">{p.data.title}</div>
                )}
              </div>

              <div class="feature-card">
                <div class="feature-meta">{formatDisplayDate(p.data.date)}</div>
                <h3 class="feature-headline">{p.data.title}</h3>
                <span class="feature-icon" aria-hidden="true">
                  <svg viewBox="0 0 24 24" role="img" focusable="false" aria-hidden="true">
                    <path d="M14 4h6v6" />
                    <path d="M20 4 11 13" />
                    <path d="M20 13v3a4 4 0 0 1-4 4H8a4 4 0 0 1-4-4V8a4 4 0 0 1 4-4h3" />
                  </svg>
                </span>
              </div>
            </a>
          );
        })}
      </div>
    </div>
  </section>

  <section id="about-contact" class="about-section">
    <div class="container about-wrap">
      <h2 class="about-title">About & Contact</h2>
      <div class="about-grid">
        <div class="about-copy">
          <p>
            Nick Mourtoupalas is a visual journalist and data reporter based in Washington, D.C.
          </p>
          <p>
            He spent more than eight years at The Washington Post, rising from copy aide to graphics reporter.
            His work spans Congress, federal spending, elections, redistricting, courts, immigration and
            economic policy, building interactive vote trackers, confirmation databases, maps and explainers
            used by millions of readers.
          </p>
          <p>
            Nick combines reporting judgment with data analysis, cartography and front-end development to make
            complex systems clear. He works from raw datasets to finished graphics, often under breaking news
            deadlines, and builds reusable tools that strengthen newsroom coverage over time.
          </p>
          <p>
            <a class="btn resume-link" href="/resume.pdf" target="_blank" rel="noopener noreferrer">View Resume</a>
          </p>
          <SocialLinks className="about-social" iconSet="navWhite" />
        </div>
        <div class="about-photo-frame">
          <img
            class="about-photo"
            src="/images/headshot.jpg"
            alt="Nick Mourtoupalas headshot"
            loading="lazy"
          />
        </div>
      </div>
    </div>
  </section>

  <Fragment slot="footer"><Footer /></Fragment>
</BaseLayout>

<style>
  :global(body) {
    background: #111111;
    color: #f3f6fb;
  }

  .section {
    padding: 0 0 80px;
    background: #111111;
    color: #f3f6fb;
    --accent: #f4f7fc;
    --text: #e8edf6;
    --muted: #a8b3c6;
    --link: #f4f7fc;
  }

  .featured-intro {
    margin: 0;
    padding-top: clamp(24px, 5vw, 52px);
    padding-bottom: clamp(24px, 4vw, 40px);
  }

  .featured-title {
    margin: 0 auto 12px;
    width: min(100%, 980px);
    font-family: "Bebas Neue", sans-serif;
    font-weight: 400;
    font-size: clamp(2.2rem, 5vw, 3.6rem);
    letter-spacing: 0.05em;
    text-transform: uppercase;
    color: #ffffff;
    line-height: 0.95;
  }

  .featured-statement {
    margin: 0 auto;
    width: min(100%, 980px);
    max-width: none;
    text-align: left;
    font-family: "Inter", sans-serif;
    font-size: 16px;
    line-height: 1.65;
    color: rgba(232, 237, 244, 0.92);
  }

  .feature-list {
    display: grid;
    gap: 88px;
    margin-inline: auto;
    margin-top: 0;
  }

  .feature-row {
    display: grid;
    grid-template-columns: 1fr;
    gap: 14px;
    text-decoration: none;
    color: inherit;
  }

  .feature-media {
    border-radius: 2px;
    overflow: hidden;
    border: 1px solid #2a2d33;
    background: #11141a;
    aspect-ratio: 16 / 9;
  }

  .feature-image {
    display: block;
    width: 100%;
    height: 100%;
    object-fit: cover;
    transition: transform 0.4s ease, filter 0.3s ease;
  }

  .feature-placeholder {
    display: grid;
    place-items: center;
    padding: 30px;
    font-family: "Merriweather", serif;
    font-size: 1.3rem;
    color: #555;
    background: linear-gradient(135deg, #ececec 0%, #dbdbdb 100%);
    text-align: center;
  }

  .feature-card {
    position: relative;
    background: #111827;
    border: 1px solid #273246;
    color: #f2f4f7;
    box-shadow: 0 20px 40px rgba(0, 0, 0, 0.5);
    padding: 20px 22px 20px;
    max-width: 760px;
  }

  .feature-meta {
    font-size: 13px;
    line-height: 1.2;
    margin-bottom: 10px;
    color: #a6adb9;
    font-family: "Franklin Gothic Medium", "Franklin Gothic", "ITC Franklin Gothic", Arial, sans-serif;
  }

  .feature-headline {
    font-size: clamp(1.5rem, 3vw, 2.15rem);
    line-height: 0.95;
    margin: 0 30px 16px 0;
    color: #ffffff;
    font-family: "Baskervville", "Baskervville Variable", Georgia, "Times New Roman", serif;
    transition: color 0.2s ease;
  }

  .feature-icon {
    position: absolute;
    top: 16px;
    right: 16px;
    line-height: 0;
    color: #a6adb9;
  }

  .feature-icon svg {
    width: 22px;
    height: 22px;
    stroke: #a6adb9;
    stroke-width: 2.4;
    fill: none;
    stroke-linecap: round;
    stroke-linejoin: round;
  }

  .feature-row:hover {
    text-decoration: none;
  }

  .feature-row:hover .feature-image {
    transform: scale(1.05);
    filter: brightness(0.9);
  }

  .feature-row:hover .feature-headline {
    color: var(--link);
  }

  .about-section {
    position: relative;
    background: #111111;
    padding: 54px 0 70px;
    color: #f3f6fb;
  }

  .about-section::before {
    content: "";
    position: absolute;
    left: 50%;
    top: 0;
    transform: translateX(-50%);
    width: var(--divider-width);
    border-top: 1px solid #232b3a;
    pointer-events: none;
  }

  .about-wrap {
    max-width: 1200px;
  }

  .about-title {
    text-align: left;
    font-family: 'Bebas Neue', sans-serif;
    font-size: clamp(1.9rem, 4.2vw, 3rem);
    font-weight: 400;
    letter-spacing: 0.04em;
    text-transform: uppercase;
    width: min(784px, 100%);
    margin: 0 auto 38px;
    color: #f4f7fc;
    font-style: normal;
  }

  .about-grid {
    display: grid;
    grid-template-columns: minmax(320px, 540px) minmax(180px, 240px);
    align-items: start;
    gap: 4px;
    justify-content: center;
  }

  .about-copy {
    font-family: 'Inter', sans-serif;
    color: #f3f6fb;
    font-size: 16px;
    line-height: 1.6;
    max-width: 540px;
    justify-self: start;
  }

  .about-copy p {
    margin: 0 0 26px;
    max-width: 90%;
  }

  :global(.about-social) {
    --social-size: 26px;
    --social-bg: #1c2431;
    --social-border: #3a4558;
    --social-color: #ffffff;
    --social-hover-bg: #253246;
    --social-hover-border: #4f617f;
    --social-hover-color: #ffffff;
  }

  .resume-link {
    border-color: #4f617f;
    background: #1c2431;
  }

  .resume-link:hover {
    background: #253246;
    border-color: #5f7395;
  }

  .about-photo-frame {
    width: 100%;
    max-width: 240px;
    justify-self: start;
    align-self: start;
    border: 6px solid #2d3748;
    background: #111722;
    padding: 0;
  }

  .about-photo {
    display: block;
    width: 100%;
    height: auto;
    aspect-ratio: 1 / 1;
    object-fit: cover;
  }

  :global(.site-footer) {
    background: #111111;
  }

  :global(.site-footer .footer-text) {
    color: #ffffff;
  }

  @media (min-width: 980px) {
    .feature-list {
      gap: 118px;
    }

    .feature-row {
      grid-template-columns: minmax(0, 50%) minmax(0, 50%);
      align-items: center;
      gap: 0;
    }

    .feature-row .feature-media {
      grid-column: 2;
      grid-row: 1;
    }

    .feature-row .feature-card {
      grid-column: 1;
      grid-row: 1;
      z-index: 2;
      margin-right: -116px;
      max-width: 760px;
    }

    .feature-row.is-reversed .feature-media {
      grid-column: 1;
    }

    .feature-row.is-reversed .feature-card {
      grid-column: 2;
      margin-right: 0;
      margin-left: -116px;
    }
  }

  @media (max-width: 980px) {
    .feature-headline {
      font-size: clamp(1.5rem, 3vw, 2.15rem);
      line-height: 1.02;
    }

  }

  @media (max-width: 900px) {
    .about-grid {
      grid-template-columns: 1fr;
      gap: 28px;
    }

    .about-copy p {
      max-width: none;
    }

    .about-photo-frame {
      width: 200px;
      height: 200px;
      max-width: 200px;
      justify-self: center;
    }
  }
</style>
